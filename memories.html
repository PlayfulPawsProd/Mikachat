<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mika's Memories ♡</title>
    <meta name="theme-color" content="#d81b60">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a0d13; /* Dark background */
            color: #ffe0f0; /* Light pink text */
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #fce4ec;
            text-align: center;
            text-shadow: 0 0 5px #d81b60;
            border-bottom: 2px solid #f06292;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        #memories-list {
            list-style: none;
            padding: 0;
        }
        .memory-item {
            background-color: rgba(240, 98, 146, 0.1);
            border: 1px solid #f06292;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: flex-start; /* Align items to top */
        }
        .memory-text {
            flex-grow: 1;
            margin-right: 15px; /* Space before delete button */
            /* Process basic formatting like in chat */
            white-space: pre-wrap; /* Preserve line breaks from memory */
            word-wrap: break-word;
        }
        .memory-text strong { color: #fce4ec; } /* Slightly brighter for emphasis */
        .memory-text em { color: #ffc1e3; font-style: italic; } /* Lighter italic */
        .memory-timestamp {
            font-size: 0.8em;
            color: #aaa;
            margin-top: 8px; /* Add space above timestamp */
            display: block; /* Make it take its own line */
             text-align: right;
        }
        .delete-memory-button {
            background-color: #ff8a80;
            color: #1a0d13;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.1s;
            flex-shrink: 0; /* Prevent button from shrinking */
        }
        .delete-memory-button:hover {
            background-color: #ff5252;
            transform: scale(1.05);
        }
        .navigation-button {
             display: block; /* Make it block level */
             width: max-content; /* Fit content width */
             margin: 30px auto 10px auto; /* Center align */
             padding: 10px 25px;
             font-size: 1em; font-weight: bold; border-radius: 20px;
             cursor: pointer; box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
             transition: transform 0.2s ease, box-shadow 0.2s ease; border: none;
             color: white; background: linear-gradient(45deg, #d81b60, #f06292);
             text-decoration: none;
             text-align: center;
        }
        .navigation-button:hover {
             transform: scale(1.05);
             box-shadow: 0 5px 12px rgba(0, 0, 0, 0.5);
        }
        .no-memories {
            text-align: center;
            color: #aaa;
            font-style: italic;
            margin-top: 40px;
        }
    </style>
</head>
<body>

    <h1>(=^･ω･^=) What Mika Remembers About Master ♡</h1>

    <ul id="memories-list">
        <!-- Memories will be loaded here by JavaScript -->
    </ul>

    <div id="no-memories-message" class="no-memories" style="display: none;">
        *Blank stare*... Mika hasn't remembered anything specific yet, Master... Talk to me more! ♡
    </div>

    <a href="index.html" class="navigation-button">Back to Chatting with Mika ♡</a>

    <script>
        const memoriesList = document.getElementById('memories-list');
        const noMemoriesMessage = document.getElementById('no-memories-message');
        const MEMORY_STORAGE_KEY = 'mikaReal_memories'; // Make sure this matches index.html

        // --- Utility to sanitize and format memory text ---
        // (Similar to chat formatting but applied here)
        function formatMemoryText(rawText) {
             const temp = document.createElement('div');
             temp.textContent = rawText; // Basic sanitization
             let formatted = temp.innerHTML;
             formatted = formatted
                 .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                 .replace(/\*(.*?)\*/g, '<em>$1</em>')
                 .replace(/`([^`]+)`/g, '<code>$1</code>')
                 .replace(/(?<!<br>)\n/g, '<br>'); // Convert newlines
             return formatted;
        }


        // --- Load and Display Memories ---
        function loadAndDisplayMemories() {
            memoriesList.innerHTML = ''; // Clear list first
            let allMemories = [];
            try {
                const stored = localStorage.getItem(MEMORY_STORAGE_KEY);
                allMemories = stored ? JSON.parse(stored) : [];
                if (!Array.isArray(allMemories)) allMemories = []; // Ensure it's an array
            } catch (e) {
                console.error("Failed to load or parse memories:", e);
                allMemories = [];
                localStorage.removeItem(MEMORY_STORAGE_KEY); // Clear corrupted data
            }

            if (allMemories.length === 0) {
                noMemoriesMessage.style.display = 'block';
            } else {
                noMemoriesMessage.style.display = 'none';
                // Display newest first
                allMemories.slice().reverse().forEach(memory => {
                    const li = document.createElement('li');
                    li.className = 'memory-item';
                    li.dataset.memoryId = memory.id; // Store ID for deletion

                    const textDiv = document.createElement('div');
                    textDiv.className = 'memory-text';
                    // Apply basic formatting to the displayed text
                    textDiv.innerHTML = formatMemoryText(memory.text);

                     const timestampSpan = document.createElement('span');
                     timestampSpan.className = 'memory-timestamp';
                     timestampSpan.textContent = `Remembered: ${memory.timestamp || new Date(memory.id).toLocaleString()}`; // Use stored timestamp or derive from ID
                     textDiv.appendChild(timestampSpan); // Add timestamp below text


                    const deleteButton = document.createElement('button');
                    deleteButton.className = 'delete-memory-button';
                    deleteButton.textContent = 'Forget';
                    deleteButton.title = 'Make Mika forget this~?';
                    deleteButton.onclick = () => deleteMemory(memory.id);

                    li.appendChild(textDiv);
                    li.appendChild(deleteButton);
                    memoriesList.appendChild(li);
                });
            }
        }

        // --- Delete Memory ---
        function deleteMemory(memoryId) {
            if (!confirm("Master! Are you sure you want me to forget this?!")) {
                return;
            }

            let allMemories = [];
            try {
                const stored = localStorage.getItem(MEMORY_STORAGE_KEY);
                allMemories = stored ? JSON.parse(stored) : [];
                 if (!Array.isArray(allMemories)) allMemories = [];
            } catch (e) {
                console.error("Failed to load memories for deletion:", e);
                return; // Don't proceed if loading failed
            }

            // Filter out the memory with the matching ID
            const updatedMemories = allMemories.filter(memory => memory.id !== memoryId);

            // Save the updated list back to localStorage
            try {
                localStorage.setItem(MEMORY_STORAGE_KEY, JSON.stringify(updatedMemories));
                console.log(`Deleted memory ID: ${memoryId}`);
                // Reload the displayed list
                loadAndDisplayMemories();
            } catch (e) {
                console.error("Failed to save memories after deletion:", e);
                alert("Mrow! Couldn't save the changes, Master! My memory is fuzzy!");
            }
        }

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', loadAndDisplayMemories);

    </script>

</body>
</html>